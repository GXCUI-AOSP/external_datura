{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e2d3bff2_eaad87db",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2024-04-22T18:44:03Z",
      "side": 1,
      "message": "This doesn\u0027t work exactly the same as the current setting since it doesn\u0027t grey out based on if private DNS is set or not at the moment. That said, I am not seeing the issues we once had when private DNS was not set and enabling this feature?",
      "revId": "e36db94cfecdc51b4a13e701eec9edad6f11fd4b",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "375a15a7_be3569fa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2024-06-21T15:57:18Z",
      "side": 1,
      "message": "From what I recall part of the reason private DNS was needed was that the connectivity check used to break when global cleartext was applied and private dns was not set. I\u0027m not sure if we worked around it in netd or if other changes have been made to AOSP that work around this. Also I\u0027m able to search something like www.yahoo.com on chromium after a fresh install, connecting to WiFi and applying global cleartext (no other steps taken)",
      "parentUuid": "e2d3bff2_eaad87db",
      "revId": "e36db94cfecdc51b4a13e701eec9edad6f11fd4b",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f8b54b8a_811ef559",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2024-06-21T16:00:39Z",
      "side": 1,
      "message": "And httpforever.com is blocked, so it is functioning",
      "parentUuid": "375a15a7_be3569fa",
      "revId": "e36db94cfecdc51b4a13e701eec9edad6f11fd4b",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7977f538_2b1c682e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-06-21T16:18:23Z",
      "side": 1,
      "message": "Private DNS was also needed because DNS itself is cleartext.\n\nIf things are working then either DNS is not being blocked, or something else.\n\nI do know that we have the framework patch to allow DNS over cleartext for the initial private DNS resolution - that might be letting all DNS traffic through.\n\nConnectivity check does default to HTTP as well, but there may be a HTTPS fallback making it work.",
      "parentUuid": "f8b54b8a_811ef559",
      "revId": "e36db94cfecdc51b4a13e701eec9edad6f11fd4b",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0d573ea3_e9cad785",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2024-06-21T19:00:24Z",
      "side": 1,
      "message": "AOSP behaviour may have changed somewhat since our original implementation. It seems as if all DNS traffic is going through uid 0 now (iirc apps used to do them through their own UIDs, so the allow rule mostly applied for the system and particularly connectivity check).\nOur implementation does have a rule to allow UID 0 DNS traffic as long as no private DNS is set. So that would explain why under any circumstance DNS was still functional even with cleartext globally restricted. So we should still make this setting dependent on private DNS given otherwise DNS is fully allowed while other cleartext traffic is blocked as expected",
      "parentUuid": "7977f538_2b1c682e",
      "revId": "e36db94cfecdc51b4a13e701eec9edad6f11fd4b",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}